<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/style/style-modal.css" type="text/css" />
  <title>Document</title>

</head>


<body>
  <div class="wrapper">
    <div id="box1">
      <p>Сделай заказ </p>
    </div>
    <div id="box2">
      <nav class="navbar-menu" id="menu">
        <a href="#">Блины</a>
        <a href="/shaurma">Шаурма</a>
        <a href="/pizza">Пицца</a>
        <a href="/sandwiches">Сенгвичи </a>
        <a href="/burgers">Бургеры </a>
        <a href="/chicken">Курица & Картофель</a>
        <a href="/salads">Тортилья & Салаты </a>
        <a href="/drinks">Напитки & Десерты </a>

      </nav>
      <div class="basket-logo">
        <p>Корзина</p>
      </div>
      <div class="basket-body">
        <div class="basket-info">
          <p>Название</p>
          <p>Количество</p>

        </div>
        <div class="basket-products">

        </div>
        <hr>
        <p id="totalSumm">Итого: 0 руб</p>
        <button class="btn" type="submit">ОФОРМИТЬ ЗАКАЗ</button>
      </div>
    </div>

    <div id="box3">

    </div>
  </div>


  <script>
    let contentBox3 = document.getElementById('box3')
    let catalog = []
    let menuActive = document.querySelectorAll('.navbar-menu a')
    menuActive.forEach((element) => {
      element.addEventListener('click', (e) => {
        e.preventDefault
        menuActive.forEach((element) => {
          element.classList.remove('active')
        })
        e.target.classList.add('active')
      })
    })

    let listProducts = []
    async function getResponse() {
      let response = await fetch('http://myjson.dit.upm.es/api/bins/9np0')
      let content = await response.json()

      return content
    }

    class Products {

      constructor() {
        let typeProduct = ''
      }

      render() {
        let htmlCatalog = ''
        let i = 0

        this.typeProduct = window.location.pathname.split('/')[1]
        console.log(this.typeProduct)
        getResponse().then((content) => {
          console.log(content.menu)
          content.menu.forEach((element) => {
            console.log(element.category)


            if (element.category === this.typeProduct) {

              htmlCatalog += `
                
                <div id='food-card' data-set='${i++}'>
                  <div id="logo-food"><img src=https://logos-marques.com/wp-content/uploads/2021/03/Subway-Logo-2048x1158.png></div>
                  <div id="photo-food"> <img
                    src="/static${element.image}">
                  </div>
                  <div id="discription-food">
                    <p>${element.name}</p>
                    <hr><a id="add-indigreen" href="#">${element.description}</a>
                      <hr>
                        <p>Цена:${element.price}</p><br>
                      </div>
                      <div id="buy-food">
                        <p>Количество</p>
                        <button type="button" id="add-food">+</button>
                        <input type="number" id="amount-food" name="amount-food" value=${element.weight}  />
                        <button type="button" id="delet-food">-</button><br>
                          <button type="button" id="button-buy">В КОРЗИНУ</button>
                      </div>
                  </div>
                `

              const html = `
                  <ul class='products-list'>
                    ${htmlCatalog}
                    </ul> `

              contentBox3.innerHTML = html
            }
          });

        })

      }


      orederQuantity() {


        window.addEventListener('click', (event) => {


          if (event.target.id === 'amount-food') {
            let card = event.target.closest('#food-card')
            let price = card.querySelectorAll('#discription-food p')
            let priceSplit = price[1].innerText.split(':')[1]
            event.target.addEventListener('input', (event) => {
              price[1].innerText = `Цена:${(event.target.value * priceSplit).toFixed(1)}`
            })
          }


          if (event.target.id === 'add-food') {
            let card = event.target.closest('#food-card')
            let price = card.querySelectorAll('#discription-food p')
            let priceSplit = price[1].innerText.split(':')[1]

            let counterWraper = event.target.closest('#buy-food')
            let counter = counterWraper.querySelector('#amount-food')
            counter.innerText = counter.value++

            if (+counter.value > 2) {
              priceSplit = (+priceSplit / (+counter.value - 1))
              price[1].innerText = `Цена:${(priceSplit * +counter.value).toFixed(1)}`
            }
            else {
              price[1].innerText = `Цена:${+priceSplit * +counter.value}`
            }

          }
          if (event.target.id === 'delet-food') {
            let card = event.target.closest('#food-card')
            let price = card.querySelectorAll('#discription-food p')
            let priceSplit = price[1].innerText.split(':')[1]

            let counterWraper = event.target.closest('#buy-food')
            let counter = counterWraper.querySelector('#amount-food')

            if (counter.value > 1) {
              counter.innerText = counter.value--

              if (+counter.value > 1) {
                priceSplit = (+priceSplit / (+counter.value + 1))

                price[1].innerText = `Цена:${(+priceSplit * (+counter.value)).toFixed(1)}`
              }
              else {
                price[1].innerText = `Цена:${((priceSplit / (+counter.value + 1)))}`
              }
            }

          }

        })
      }

      addProductsBascket() {
        let listProducts = []
        let i = 0
        let cardItemHTML
        let modalHtml
        let summa = 0



        window.addEventListener('click', (event) => {
          if (event.target.id === 'button-buy') {
            let card = event.target.closest('#food-card')
            let btn = card.querySelector('#button-buy')
            let contentBox3 = document.getElementById('box3')

            if (this.typeProduct === 'sandwiches') {
              modalHtml = `
                <dialog id="modal-content">
                  <div id="modal-top">
                  </div>
                  <form method="dialog">
                    <menu id="menu-modal">
                      <p>Размер</p>
                      <p>Хлеб</p>
                      <p>Овощи</p>
                      <p>Соусы</p>
                      <p>Начинка</p>
                      <p>Готово!</p>
                    </menu>
                    </form>
                    </dialog>
                    `

              contentBox3.innerHTML += modalHtml
              let modal = document.getElementById("modal-content")
              console.log(modal)
              modal.showModal()
              //modal.close()

            }

            let addBascketProduckts = () => {

              let card = event.target.closest('#food-card')
              let basket_products = document.querySelector('.basket-products')
              let discription = card.querySelectorAll('#discription-food p')
              let name_food = discription[0].innerText
              let price_food = discription[1].innerText.split(':')[1]
              let btn = card.querySelector('#button-buy')

              let resultSumma = document.getElementById('totalSumm')

              cardItemHTML = `
              <div class="order" data-order=${i++}>
                <p>${name_food}</p> 
                <p>${price_food}</p>
              <div>
              `
              basket_products.innerHTML += `${cardItemHTML}<br>`
              price_food = Number(price_food)
              summa = summa + price_food
              console.log(summa)
              resultSumma.innerText = `Итого: ${summa} руб`
            }
            addBascketProduckts()
          }


        })


      }


    }
    let products = new Products()

    products.render()
    products.orederQuantity()
    products.addProductsBascket()

  </script>

</body>


</html>